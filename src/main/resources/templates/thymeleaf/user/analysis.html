<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{thymeleaf/layouts/user_layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript">
//나의 정보조회
// function myInfo(){
	$(function(){
		$.ajax({
			url:"/user/info_balance",
			method:'get',
			dataType:'json',
			success:function(data){
				var response=data;
				console.log(response);
// 				var res_list=data['res_list'];
// 				console.log(res_list);
				$("#list").empty();//화면 초기화
				
//	 				급여계좌
//	     		83764585969076959 [국민은행]
				for(var i=0;i<response.length;i++){
					$("#list").append(
						'<div class="box container" style="border:1px solid #009999">'+
	            		'	<div>'+
	            		'		<p>'+response[i].bank_name+'  '+
// 	            		response[i].fintech_use_num+
	            		'<br/>'+response[i].balance_amt+'원</p>'+
// 	            		'		<h4>'+response[i].fintech_use_num+'</h4>'+
	            			
	            		'	</div>'+
	            		'</div>'	
					)                         
				}                      
			},
			error:function(xhr, status, error){
//	 			location.reload();//페이지 새로고침
				console.log(xhr.responseText);
//	 				alert("통신실패");
			}
		})
})
	
	function myPattern(){
		$.ajax({
			url:"/user/pattern",
			method:"get",
			async:"false",
			dataType:"json",
			success:function(data){
				var graphData1 =data.category_labels;
				var graphData2 =data.category_data;
				var ctx = document.getElementById('myChart').getContext('2d');
		        var myChart = new Chart(ctx, {
		            type: 'bar',
		            data: {
		                labels: graphData1,
		                datasets: [{
		                    label: 'Graph Data',
		                    data: graphData2,
		                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
		                    borderColor: 'rgba(75, 192, 192, 1)',
		                    borderWidth: 1,
		                    barPercentage: 1.0, // Adjust the width of the bars (80% of available space)
		                    categoryPercentage: 1.0, // Adjust the spacing between the bars (90% of available space)
		                    barSpacing: '10px'
		                }]
		            },
		            options: {
		                responsive: true,
		                scales: {
		                    y: {
		                        beginAtZero: true
		                    }
		                   
		            
		                    
		                }
		            }
		        });
			},
			error:function(xhr,status,error){
				console.log(xhr.responseText);
			}
		})
		
}

</script>
  
<style type="text/css">

	input[type="button"]{
		text-align:center;
	  	
	  	
		
		margin-top:10px;
		margin-bottom:10px;
	}
	
</style>
</head>


<body>
<div layout:fragment="content">
<h1>소비패턴분석</h1>
<!-- <p th:text="${session.dto.name}+'님'"></p> -->

 <main class="mb-4">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-6">
                    <p>소비패턴이 궁금하지 않으신가요?</p>
                    <p>클릭 하시면 소비,분석,비교,예측,카드 추천해 드립니다.</p>
					<p>참여하고 무료 기프티콘 받아가세요!!</p>
					
                </div>
                <input style="border-radius: 10px;background-color: #000099; width:300px;" type="button" class="btn btn-dark" value="소비패턴분석하기" onclick="myPattern()" />
            	<div id="list">
<!--                 <p th:text="${userMeDto}"></p>	 -->
                </div>
                <div class="container"> 
         			<canvas id="myChart" height="300"></canvas> 
      			</div>
            </div>
            
        </div>
    </main>
</div>
</body>
</html>